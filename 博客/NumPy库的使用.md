---
title: NumPy库的使用
date: 2017-01-28 21:30:21
categories: 技术
tags: Python
---
NumPy是进行科学计算和数据分析的必备工具，相比于Python内置的列表类型，nArray提供了速度堪比原生C的数组类型，这次我们来介绍一下NumPy的使用。
<!--more-->
导入包，并重命名为np，这是约定俗成的方式。

```
import numpy as np
```

NumPy数组的初始化方式

```
a = np.array([1, 2, 3, 4])
b = np.array((5, 6, 7, 8))
c = np.array([[1, 2, 3], [4, 5, 6], [7, 8, 9], [10, 11, 12]])
```

测试一下输出结果

```
a
```

```
array([1, 2, 3, 4])

```

```
c
```

```
array([[ 1,  2,  3],
       [ 4,  5,  6],
       [ 7,  8,  9],
       [10, 11, 12]])

```

数组的大小可以通过其shape属性获得

```
a.shape
```

```
(4,)

```

```
c.shape
```

```
(4, 3)

```

可以通过调整shape来调整数组的每一维度的大小

```
c.shape = 3, 4
c
```

```
array([[ 1,  2,  3,  4],
       [ 5,  6,  7,  8],
       [ 9, 10, 11, 12]])

```

```
c.shape = 6, -1
c
```

```
array([[ 1,  2],
       [ 3,  4],
       [ 5,  6],
       [ 7,  8],
       [ 9, 10],
       [11, 12]])

```

使用数组的reshape方法，可以创建一个改变了尺寸的新数组

```
d = a.reshape(2, 2)
d
```

```
array([[1, 2],
       [3, 4]])

```

a和d其实共享数据存储内存区域，因此修改其中任意一个数组的元素都会同时修改另外一个数组的内容

```
a[1] = 10
d
```

```
array([[ 1, 10],
       [ 3,  4]])

```

数组的元素类型可以通过dtype属性获得

```
a.dtype
```

```
dtype('int32')

```

```
e = np.array([1, 2, 3, 4], dtype=np.float)
e
```

```
array([ 1.,  2.,  3.,  4.])

```

arange函数类似于python的range函数，通过指定开始值、终值和步长来创建一维数组

```
np.arange(1, 10, 1)
```

```
array([1, 2, 3, 4, 5, 6, 7, 8, 9])

```

linspace函数通过指定开始值、终值和元素个数来创建一维数组

```
np.linspace(0, 1, 5)
```

```
array([ 0.  ,  0.25,  0.5 ,  0.75,  1.  ])

```

fromstring函数可以从字节序列创建数组

```
s = 'abcdefgh'
```

```
np.fromstring(s, dtype=np.int8)
```

```
array([ 97,  98,  99, 100, 101, 102, 103, 104], dtype=int8)

```

```
np.fromstring(s, dtype=np.int16)
```

```
array([25185, 25699, 26213, 26727], dtype=int16)

```

```
np.fromstring(s, dtype=np.float)
```

```
array([  8.54088322e+194])

```

fromfunction函数的第一个参数为计算每个数组元素的函数，第二个参数为数组的大小(shape)，因为它支持多维数组，所以第二个参数必须是一个序列

```
func = lambda x: x%4 + 1
```

```
np.fromfunction(func, (10,), dtype=np.int8)
```

```
array([1, 2, 3, 4, 1, 2, 3, 4, 1, 2], dtype=int8)

```

```
func_2 = lambda x, y: (x + 1)*(y + 1)
```

```
np.fromfunction(func_2, (9,9), dtype=np.int8)
```

```
array([[ 1,  2,  3,  4,  5,  6,  7,  8,  9],
       [ 2,  4,  6,  8, 10, 12, 14, 16, 18],
       [ 3,  6,  9, 12, 15, 18, 21, 24, 27],
       [ 4,  8, 12, 16, 20, 24, 28, 32, 36],
       [ 5, 10, 15, 20, 25, 30, 35, 40, 45],
       [ 6, 12, 18, 24, 30, 36, 42, 48, 54],
       [ 7, 14, 21, 28, 35, 42, 49, 56, 63],
       [ 8, 16, 24, 32, 40, 48, 56, 64, 72],
       [ 9, 18, 27, 36, 45, 54, 63, 72, 81]], dtype=int8)

```

数组元素的存取方法和Python的标准方法相同

```
a = np.arange(10)

print(a[5])
print(a[:5])
print(a[3:5])
print(a[:5:2])
print(a[::-1])
```

```
5
[0 1 2 3 4]
[3 4]
[0 2 4]
[9 8 7 6 5 4 3 2 1 0]

```

```
b = a[3:5]
b[1] = 100
a
```

```
array([  0,   1,   2,   3, 100,   5,   6,   7,   8,   9])

```

使用整数序列对数组元素进行存取时，将使用整数序列中的每个元素作为下标，整数序列可以是列表或者数组。使用整数序列作为下标获得的数组不和原始数组共享数据空间。

```
x = np.arange(10)
```

```
b = x[[3, 4, 5]]
b[2] = 100
x
```

```
array([0, 1, 2, 3, 4, 5, 6, 7, 8, 9])

```

```
x[np.array([True if i%2 else False for i in range(x.shape[0])])]
```

```
array([1, 3, 5, 7, 9])

```

```
x = np.random.rand(10)
x
```

```
array([ 0.88667515,  0.94508437,  0.02907093,  0.48534776,  0.09488472,
        0.62854006,  0.01436024,  0.31575344,  0.72750149,  0.55018248])

```

```
x > 0.5
```

```
array([ True,  True, False, False, False,  True, False, False,  True,  True], dtype=bool)

```

当使用布尔数组b作为下标存取数组x中的元素时，将收集数组x中所有在数组b中对应下标为True的元素。使用布尔数组作为下标获得的数组不和原始数组共享数据空间，注意这种方式只对应于布尔数组，不能使用布尔列表。

```
x[x>0.5]
```

```
array([ 0.88667515,  0.94508437,  0.62854006,  0.72750149,  0.55018248])

```

多维数组的存取和一维数组类似，因为多维数组有多个轴，因此它的下标需要用多个值来表示，NumPy采用组元(tuple)作为数组的下标

```
x = np.arange(36, dtype=np.int8).reshape((6, 6))
x
```

```
array([[ 0,  1,  2,  3,  4,  5],
       [ 6,  7,  8,  9, 10, 11],
       [12, 13, 14, 15, 16, 17],
       [18, 19, 20, 21, 22, 23],
       [24, 25, 26, 27, 28, 29],
       [30, 31, 32, 33, 34, 35]], dtype=int8)

```

```
print(x[0, 2:5])
print(x[0:2, 2:5])
print(x[1:3, 1])
print(x[::2, ::2])
print(x[:3, [1, 3, 5]])
```

```
[2 3 4]
[[ 2  3  4]
 [ 8  9 10]]
[ 7 13]
[[ 0  2  4]
 [12 14 16]
 [24 26 28]]
[[ 1  3  5]
 [ 7  9 11]
 [13 15 17]]

```

结构体的使用

```
person = np.dtype({
        "names": ['Name', 'Age', 'Weight'], 
        "formats": ['S32', 'i', 'f']
    })
```

```
persons = np.array([("Liu", 18, 70.0),
                    ("Zhang", 12, 10.0),
                    ("Lin", 10, 13.2)], dtype=person)
```

```
persons
```

```
array([(b'Liu', 18, 70.0), (b'Zhang', 12, 10.0),
       (b'Lin', 10, 13.199999809265137)], 
      dtype=[('Name', 'S32'), ('Age', '<i4'), ('Weight', '<f4')])

```

```
c = persons[0]['Name']
c = 'Li'
persons
```

```
array([(b'Liu', 18, 70.0), (b'Zhang', 12, 10.0),
       (b'Lin', 10, 13.199999809265137)], 
      dtype=[('Name', 'S32'), ('Age', '<i4'), ('Weight', '<f4')])

```

```
persons[:]['Name']
```

```
array([b'Liu', b'Zhang', b'Lin'], 
      dtype='|S32')

```

```
persons.tofile('test.bin')
```

ufunc的使用

```
x = np.linspace(0, 2*np.pi, 10)
np.sin(x)
```

```
array([  0.00000000e+00,   6.42787610e-01,   9.84807753e-01,
         8.66025404e-01,   3.42020143e-01,  -3.42020143e-01,
        -8.66025404e-01,  -9.84807753e-01,  -6.42787610e-01,
        -2.44929360e-16])

```

```
a = np.array([[1, 2, 3], [4, 5, 6]])
b = a.copy().reshape(-1,2)
```

```
np.dot(a, b)
```

```
array([[22, 28],
       [49, 64]])

```

```
np.outer([1,2,3],[4,5,6,7])
```

```
array([[ 4,  5,  6,  7],
       [ 8, 10, 12, 14],
       [12, 15, 18, 21]])

```

```
np.inner(a, a)
```

```
array([[14, 32],
       [32, 77]])

np.linalg.inv([[1, 2, 3], [4, 5, 6], [7, 8, 9]])
array([[  3.15251974e+15,  -6.30503948e+15,   3.15251974e+15],
       [ -6.30503948e+15,   1.26100790e+16,  -6.30503948e+15],
       [  3.15251974e+15,  -6.30503948e+15,   3.15251974e+15]])
```